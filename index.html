<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Timer - Muscu/CrossFit</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
        }

        .gradient-bg {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            transition: background 0.5s;
        }

        .gradient-gray {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }

        .gradient-orange {
            background: linear-gradient(135deg, #7c2d12 0%, #991b1b 50%, #7c2d12 100%);
        }

        .gradient-green {
            background: linear-gradient(135deg, #14532d 0%, #166534 50%, #14532d 100%);
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            max-width: 28rem;
            width: 100%;
        }

        .workout-btn {
            width: 100%;
            padding: 1.5rem;
            border-radius: 1rem;
            border: none;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            transition: all 0.2s;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }

        .workout-btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .btn-red { background: #ef4444; }
        .btn-purple { background: #a855f7; }
        .btn-blue { background: #3b82f6; }

        .btn-icon {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .title {
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: #9ca3af;
            text-align: center;
            margin-bottom: 2rem;
        }

        .timer-display {
            font-size: 6rem;
            font-weight: bold;
            color: white;
            text-align: center;
            margin: 1rem 0;
            transition: all 0.3s;
        }

        .timer-warning {
            color: #fde047;
            animation: pulse 1s infinite;
        }

        .exercise-name {
            color: white;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 1rem;
        }

        .badge {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            border-radius: 9999px;
            font-weight: bold;
            color: white;
            margin-bottom: 1rem;
        }

        .badge-work { background: #f97316; }
        .badge-rest { background: #22c55e; }

        .progress-bar {
            width: 100%;
            height: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 9999px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: white;
            transition: width 0.3s;
            border-radius: 9999px;
        }

        .controls {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            align-items: center;
            margin-top: 1rem;
        }

        .nav-controls {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 9999px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .btn-lg {
            padding: 1rem;
        }

        .btn-xl {
            padding: 1.5rem;
            background: white;
            color: #1a1a2e;
        }

        .btn-xl:hover {
            background: #f3f4f6;
        }

        .back-btn {
            color: white;
            background: none;
            border: none;
            cursor: pointer;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
        }

        .back-btn:hover {
            color: #d1d5db;
        }

        .next-exercise {
            margin-top: 1.5rem;
            text-align: center;
        }

        .next-label {
            color: rgba(255, 255, 255, 0.75);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .next-name {
            color: white;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .finished {
            text-align: center;
        }

        .finished-emoji {
            font-size: 5rem;
            margin-bottom: 1rem;
            animation: bounce 1s infinite;
        }

        .finished-title {
            font-size: 3rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1rem;
        }

        .finished-subtitle {
            font-size: 1.5rem;
            color: white;
            margin-bottom: 2rem;
        }

        .animation-container {
            height: 8rem;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .stick-figure {
            animation: bounce 1s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .header-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            color: white;
            margin-bottom: 2rem;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .header-progress {
            font-size: 0.875rem;
        }

        .center-icon {
            display: flex;
            justify-content: center;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const WORKOUTS = {
          pectoraux: {
            name: "PECTORAUX",
            icon: "üí™",
            color: "btn-red",
            exercises: [
              { name: "Pompes", duration: 30, type: "work" },
              { name: "Pause", duration: 30, type: "rest" },
              { name: "Pompes release hand", duration: 30, type: "work" },
              { name: "Pause", duration: 30, type: "rest" },
              { name: "Pompes mains sur chaise", duration: 30, type: "work" },
              { name: "Pause", duration: 30, type: "rest" },
              { name: "Pompes mains √©cart√©es", duration: 30, type: "work" },
              { name: "Pause", duration: 30, type: "rest" },
              { name: "Pompes d√©cal√©es", duration: 30, type: "work" }
            ]
          },
          bicepsTriceps: {
            name: "BICEPS TRICEPS",
            icon: "üí™",
            color: "btn-purple",
            exercises: [
              { name: "Pompes sur chaise", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" },
              { name: "Dips chaise", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" },
              { name: "Soulever poids droit", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" },
              { name: "Soulever poids gauche", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" },
              { name: "Dips au sol", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" }
            ]
          },
          abdos: {
            name: "ABDOS",
            icon: "üî•",
            color: "btn-blue",
            exercises: [
              { name: "Reverse crunch", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" },
              { name: "Russian twist", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" },
              { name: "Sit up", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" },
              { name: "Abdos portefeuille", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" },
              { name: "Circle", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" },
              { name: "Jambes tendues droite-gauche", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" },
              { name: "Spider", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" },
              { name: "Touche pieds", duration: 45, type: "work" },
              { name: "Pause", duration: 15, type: "rest" },
              { name: "Gainage", duration: 45, type: "work" }
            ]
          }
        };

        function WorkoutTimer() {
          const [selectedWorkout, setSelectedWorkout] = useState(null);
          const [currentExerciseIndex, setCurrentExerciseIndex] = useState(0);
          const [timeLeft, setTimeLeft] = useState(0);
          const [isRunning, setIsRunning] = useState(false);
          const [isFinished, setIsFinished] = useState(false);
          const audioContextRef = useRef(null);
          const timerRef = useRef(null);
          const hasBeepedRef = useRef(false);

          useEffect(() => {
            audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
            return () => {
              if (audioContextRef.current) {
                audioContextRef.current.close();
              }
            };
          }, []);

          const playBeep = (frequency = 800, duration = 200) => {
            if (!audioContextRef.current) return;
            
            const oscillator = audioContextRef.current.createOscillator();
            const gainNode = audioContextRef.current.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContextRef.current.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContextRef.current.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContextRef.current.currentTime + duration / 1000);
            
            oscillator.start(audioContextRef.current.currentTime);
            oscillator.stop(audioContextRef.current.currentTime + duration / 1000);
          };

          const playDoubleBeep = () => {
            playBeep(600, 150);
            setTimeout(() => playBeep(600, 150), 200);
          };

          useEffect(() => {
            if (isRunning && timeLeft > 0) {
              timerRef.current = setInterval(() => {
                setTimeLeft(prev => {
                  if (prev <= 1) {
                    playBeep(1000, 300);
                    hasBeepedRef.current = false;
                    const nextIndex = currentExerciseIndex + 1;
                    if (nextIndex < selectedWorkout.exercises.length) {
                      setCurrentExerciseIndex(nextIndex);
                      return selectedWorkout.exercises[nextIndex].duration;
                    } else {
                      setIsRunning(false);
                      setIsFinished(true);
                      return 0;
                    }
                  } else if (prev === 5 && !hasBeepedRef.current) {
                    playDoubleBeep();
                    hasBeepedRef.current = true;
                  }
                  return prev - 1;
                });
              }, 1000);
            } else {
              if (timerRef.current) {
                clearInterval(timerRef.current);
              }
            }

            return () => {
              if (timerRef.current) {
                clearInterval(timerRef.current);
              }
            };
          }, [isRunning, timeLeft, currentExerciseIndex, selectedWorkout]);

          const startWorkout = (workoutKey) => {
            const workout = WORKOUTS[workoutKey];
            setSelectedWorkout(workout);
            setCurrentExerciseIndex(0);
            setTimeLeft(workout.exercises[0].duration);
            setIsFinished(false);
            setIsRunning(false);
            hasBeepedRef.current = false;
          };

          const toggleTimer = () => {
            setIsRunning(!isRunning);
          };

          const resetWorkout = () => {
            setIsRunning(false);
            setCurrentExerciseIndex(0);
            if (selectedWorkout) {
              setTimeLeft(selectedWorkout.exercises[0].duration);
            }
            setIsFinished(false);
            hasBeepedRef.current = false;
          };

          const backToMenu = () => {
            setSelectedWorkout(null);
            setIsRunning(false);
            setCurrentExerciseIndex(0);
            setTimeLeft(0);
            setIsFinished(false);
            hasBeepedRef.current = false;
          };

          const skipTime = (seconds) => {
            setTimeLeft(prev => {
              const newTime = prev - seconds;
              if (newTime <= 0) return 1;
              if (selectedWorkout && selectedWorkout.exercises[currentExerciseIndex]) {
                const currentExercise = selectedWorkout.exercises[currentExerciseIndex];
                if (newTime > currentExercise.duration) return currentExercise.duration;
              }
              hasBeepedRef.current = false;
              return newTime;
            });
          };

          const previousExercise = () => {
            if (currentExerciseIndex > 0) {
              const prevIndex = currentExerciseIndex - 1;
              setCurrentExerciseIndex(prevIndex);
              setTimeLeft(selectedWorkout.exercises[prevIndex].duration);
              hasBeepedRef.current = false;
            }
          };

          const nextExercise = () => {
            if (currentExerciseIndex < selectedWorkout.exercises.length - 1) {
              const nextIndex = currentExerciseIndex + 1;
              setCurrentExerciseIndex(nextIndex);
              setTimeLeft(selectedWorkout.exercises[nextIndex].duration);
              hasBeepedRef.current = false;
            }
          };

          const getExerciseAnimation = (exerciseName) => {
            const name = exerciseName.toLowerCase();
            
            if (name.includes('pompe')) {
              return (
                <svg className="stick-figure" width="64" height="64" viewBox="0 0 64 64">
                  <circle cx="32" cy="16" r="8" stroke="white" strokeWidth="2" fill="none" />
                  <line x1="32" y1="24" x2="32" y2="40" stroke="white" strokeWidth="2" />
                  <line x1="20" y1="32" x2="44" y2="32" stroke="white" strokeWidth="2" />
                  <line x1="24" y1="40" x2="24" y2="56" stroke="white" strokeWidth="2" />
                  <line x1="40" y1="40" x2="40" y2="56" stroke="white" strokeWidth="2" />
                </svg>
              );
            }
            
            if (name.includes('pause')) {
              return <div style={{fontSize: '4rem'}}>üí§</div>;
            }
            
            return (
              <svg className="stick-figure" width="64" height="64" viewBox="0 0 64 64">
                <circle cx="32" cy="16" r="8" stroke="white" strokeWidth="2" fill="none" />
                <line x1="32" y1="24" x2="32" y2="44" stroke="white" strokeWidth="2" />
                <line x1="20" y1="32" x2="44" y2="32" stroke="white" strokeWidth="2" />
                <line x1="24" y1="44" x2="24" y2="60" stroke="white" strokeWidth="2" />
                <line x1="40" y1="44" x2="40" y2="60" stroke="white" strokeWidth="2" />
              </svg>
            );
          };

          if (!selectedWorkout) {
            return (
              <div className="gradient-bg gradient-gray">
                <div style={{maxWidth: '28rem', width: '100%'}}>
                  <div className="center-icon" style={{fontSize: '4rem'}}>
                    ‚ö°
                  </div>
                  <h1 className="title">Workout Timer</h1>
                  <p className="subtitle">Choisissez votre programme</p>
                  
                  <div>
                    {Object.entries(WORKOUTS).map(([key, workout]) => {
                      return (
                        <button
                          key={key}
                          onClick={() => startWorkout(key)}
                          className={`workout-btn ${workout.color}`}
                        >
                          <div className="btn-icon">
                            <span style={{fontSize: '2rem'}}>{workout.icon}</span>
                            <div style={{textAlign: 'left'}}>
                              <div>{workout.name}</div>
                              <div style={{fontSize: '0.875rem', opacity: 0.9}}>{workout.exercises.length} exercices</div>
                            </div>
                          </div>
                          <span>‚ñ∂</span>
                        </button>
                      );
                    })}
                  </div>
                </div>
              </div>
            );
          }

          const currentExercise = selectedWorkout.exercises[currentExerciseIndex];
          const progress = ((currentExerciseIndex + 1) / selectedWorkout.exercises.length) * 100;
          const isRest = currentExercise.type === 'rest';

          return (
            <div className={`gradient-bg ${isRest ? 'gradient-green' : 'gradient-orange'}`}>
              {isFinished ? (
                <div className="finished">
                  <div className="finished-emoji">üéâ</div>
                  <h2 className="finished-title">BRAVO !</h2>
                  <p className="finished-subtitle">Workout termin√© !</p>
                  <button onClick={backToMenu} className="btn btn-xl btn-lg">
                    Retour au menu
                  </button>
                </div>
              ) : (
                <div style={{maxWidth: '28rem', width: '100%'}}>
                  <button onClick={backToMenu} className="back-btn">
                    ‚Üê Retour au menu
                  </button>

                  <div className="card">
                    <div className="header-info">
                      <div className="header-title">{selectedWorkout.name}</div>
                      <div className="header-progress">
                        Exercice {currentExerciseIndex + 1}/{selectedWorkout.exercises.length}
                      </div>
                      <div className="progress-bar" style={{width: '100%'}}>
                        <div className="progress-fill" style={{width: `${progress}%`}} />
                      </div>
                    </div>

                    <div style={{textAlign: 'center'}}>
                      <div style={{display: 'flex', justifyContent: 'center', marginBottom: '1rem'}}>
                        <div className={`badge ${isRest ? 'badge-rest' : 'badge-work'}`}>
                          {isRest ? 'üí§ REPOS' : 'üí™ EXERCICE'}
                        </div>
                      </div>
                      <h3 className="exercise-name">{currentExercise.name}</h3>
                      
                      <div className="animation-container">
                        {getExerciseAnimation(currentExercise.name)}
                      </div>
                      
                      <div className={`timer-display ${timeLeft <= 5 ? 'timer-warning' : ''}`}>
                        {timeLeft}
                      </div>
                      <p style={{color: 'white', fontSize: '1.125rem', opacity: 0.75}}>secondes</p>
                    </div>

                    <div className="nav-controls">
                      <button
                        onClick={previousExercise}
                        disabled={currentExerciseIndex === 0}
                        className="btn"
                      >
                        <span>‚óÑ Pr√©c√©dent</span>
                      </button>
                      <button
                        onClick={nextExercise}
                        disabled={currentExerciseIndex === selectedWorkout.exercises.length - 1}
                        className="btn"
                      >
                        <span>Suivant ‚ñ∫</span>
                      </button>
                    </div>

                    <div className="controls">
                      <button onClick={() => skipTime(-10)} className="btn btn-lg">
                        <span>‚è™</span>
                      </button>
                      <button onClick={toggleTimer} className="btn btn-xl">
                        {isRunning ? '‚è∏' : '‚ñ∂'}
                      </button>
                      <button onClick={() => skipTime(10)} className="btn btn-lg">
                        <span>‚è©</span>
                      </button>
                      <button onClick={resetWorkout} className="btn btn-lg">
                        <span>‚Üª</span>
                      </button>
                    </div>
                  </div>

                  {currentExerciseIndex < selectedWorkout.exercises.length - 1 && (
                    <div className="next-exercise">
                      <p className="next-label">Prochain :</p>
                      <p className="next-name">
                        {selectedWorkout.exercises[currentExerciseIndex + 1].name}
                      </p>
                    </div>
                  )}
                </div>
              )}
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WorkoutTimer />);
    </script>
</body>
</html>
